# Few-shot이 뭐야?

## 📚 Few-shot Learning이란?

**Few-shot Learning**은 AI 모델에게 **몇 개의 예시(예제)를 보여주고** 그 패턴을 학습하게 하는 기법입니다.

### 간단한 비유

- **Zero-shot**: 설명만 듣고 바로 실행 (예: "인플레이션이 뭐야?" → 설명만 듣고 답변)
- **Few-shot**: 예시 2~3개를 보여주고 "이런 식으로 답변해줘" (예: 인플레이션 설명 예시 2개 보여주고 → 비슷한 스타일로 답변)
- **Many-shot**: 많은 예시를 보여줌 (일반적으로 fine-tuning에 해당)

## 🔍 우리 코드에서의 Few-shot

### 원본 버전 (`persona.py`)

```python
# Few-shot 예제 없음
return [sys, dev, usr]  # 3개 메시지
```

- 시스템 프롬프트만으로 동작
- 메시지 수: **3개**

### 최적화 버전 (`persona_optimized.py`)

```python
_FEWSHOT_COMPACT: List[Dict[str, str]] = [
    {
        "role": "user",
        "content": "인플레이션이 뭐야?",
    },
    {
        "role": "assistant",
        "content": (
            "1️⃣ 이름: 인플레이션은~\n"
            "2️⃣ 뜻: 물가가 전반적으로 서서히 오르는 거야.\n"
            "3️⃣ 영향: 같은 돈으로 살 수 있는 게 줄어들어.\n\n"
            "더 궁금한 거 있면 편하게 물어봐!"
        ),
    },
    {
        "role": "user",
        "content": "금리가 오르면 주식이 왜 떨어져?",
    },
    {
        "role": "assistant",
        "content": (
            "금리 인상 → 예금 이자 ↑ → 주식 자금 이탈 → 주가 하락 ↓\n"
            "그건 말이야~ 은행 이자가 오르면 위험한 자산을 피하려고 해서 그래."
        ),
    },
]

# Few-shot 예제 포함
return [sys, dev, *_FEWSHOT_COMPACT, usr]  # 7개 메시지
```

- Few-shot 예제 2개 추가
- 메시지 수: **7개** (3개 → 7개로 증가)

## 💡 Few-shot의 효과

### 장점 ✅

1. **응답 스타일 일관성**: 예시를 보여주면 모델이 비슷한 스타일로 답변
2. **구조 명확화**: 원하는 출력 형식을 구체적으로 보여줄 수 있음
3. **컨텍스트 이해 향상**: 예시를 통해 의도를 더 정확히 전달

### 단점 ⚠️

1. **토큰 사용량 증가**: 예제를 추가하면 입력 토큰이 늘어남
2. **메시지 수 증가**: 대화 히스토리가 길어짐
3. **비용 증가**: 더 많은 토큰 = 더 많은 비용

## 📊 우리 실험에서의 Few-shot 영향

### 메시지 수 변화

| 버전 | 메시지 수 | Few-shot |
|------|----------|----------|
| 원본 | 3개 | 없음 |
| 최적화 | 7개 | 2개 추가 (+4개) |

### 토큰 사용량

- **입력 토큰**: Few-shot 추가로 약 250토큰 증가
- **출력 토큰**: `max_tokens=400` 제한으로 평균 124토큰

### 성능 영향

- **예상**: Few-shot 추가로 메시지 수 증가 → 처리 시간 증가
- **실제**: `max_tokens=400` 제한 효과가 더 커서 **전체 시간은 단축됨**
  - 원본: 평균 4.616초
  - 최적화: 평균 3.178초 (**31.1% 더 빠름**)

## 🎯 Few-shot 예제 분석

### 예제 1: 인플레이션 설명

**질문**: "인플레이션이 뭐야?"

**답변 예시**:
```
1️⃣ 이름: 인플레이션은~
2️⃣ 뜻: 물가가 전반적으로 서서히 오르는 거야.
3️⃣ 영향: 같은 돈으로 살 수 있는 게 줄어들어.

더 궁금한 거 있으면 편하게 물어봐!
```

**효과**: 모델이 "3단 구조(이름-뜻-영향)" 형식으로 답변하도록 유도

### 예제 2: 금리와 주식 관계

**질문**: "금리가 오르면 주식이 왜 떨어져?"

**답변 예시**:
```
금리 인상 → 예금 이자 ↑ → 주식 자금 이탈 → 주가 하락 ↓
그건 말이야~ 은행 이자가 오르면 위험한 자산을 피하려고 해서 그래.
```

**효과**: 모델이 "흐름도 스타일(화살표 사용)"로 답변하도록 유도

## 🔬 Few-shot vs 시스템 프롬프트

### 시스템 프롬프트만 사용 (원본)

```
"너는 '알부엉'이라는 친근한 튜터형 AI야. 반말로 차분하고 간결하게 설명해.
핵심 역할은 경제 용어를 일상 언어로 번역하는 거야..."
```

- ✅ 토큰 절감
- ✅ 간단함
- ⚠️ 모델이 스타일을 추측해야 함

### Few-shot 추가 (최적화)

```
[시스템 프롬프트]
[Few-shot 예제 2개]
[실제 질문]
```

- ✅ 구체적인 예시로 스타일 명확화
- ✅ 응답 일관성 향상
- ⚠️ 토큰 사용량 증가

## 💭 결론

**Few-shot**은 모델에게 "이런 식으로 답변해줘"라고 **구체적인 예시를 보여주는** 기법입니다.

우리 코드에서는:
- ✅ Few-shot으로 응답 스타일을 명확히 지정
- ⚠️ 메시지 수는 증가했지만 (3개 → 7개)
- ✅ `max_tokens` 제한으로 전체 성능은 향상됨

**트레이드오프**: 토큰 사용량 vs 응답 품질/일관성

---

## 📚 추가 학습 자료

- **In-context Learning**: Few-shot의 다른 이름
- **Prompt Engineering**: Few-shot을 활용한 프롬프트 설계 기법
- **Chain-of-Thought**: Few-shot으로 추론 과정을 보여주는 기법

